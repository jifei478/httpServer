'use strict';const a52_0x5a04e=a52_0x4be6;(function(_0x366ec5,_0x133c32){const _0x3fd45b=a52_0x4be6,_0x2b101d=_0x366ec5();while(!![]){try{const _0x49130b=parseInt(_0x3fd45b(0x13e))/0x1+parseInt(_0x3fd45b(0x145))/0x2*(-parseInt(_0x3fd45b(0x158))/0x3)+-parseInt(_0x3fd45b(0x15b))/0x4*(-parseInt(_0x3fd45b(0x147))/0x5)+parseInt(_0x3fd45b(0x138))/0x6+-parseInt(_0x3fd45b(0x164))/0x7+parseInt(_0x3fd45b(0x161))/0x8+-parseInt(_0x3fd45b(0x168))/0x9;if(_0x49130b===_0x133c32)break;else _0x2b101d['push'](_0x2b101d['shift']());}catch(_0x4efb1a){_0x2b101d['push'](_0x2b101d['shift']());}}}(a52_0x5dfa,0xd2880));var __importDefault=this&&this[a52_0x5a04e(0x141)]||function(_0x163a5a){const _0x40fec5=a52_0x5a04e;return _0x163a5a&&_0x163a5a[_0x40fec5(0x156)]?_0x163a5a:{'default':_0x163a5a};};Object['defineProperty'](exports,a52_0x5a04e(0x156),{'value':!![]}),exports[a52_0x5a04e(0x149)]=void 0x0;const tsrpc_1=require(a52_0x5a04e(0x14f)),serviceProto_1=require('../../shared/protocols/serviceProto'),gameClient_1=require('./clients/gameClient'),chatClient_1=require(a52_0x5a04e(0x15f)),jsonwebtoken_1=__importDefault(require(a52_0x5a04e(0x15c))),Config_1=require(a52_0x5a04e(0x16d)),Logger_1=require(a52_0x5a04e(0x152));exports[a52_0x5a04e(0x149)]=new tsrpc_1[(a52_0x5a04e(0x148))](serviceProto_1['serviceProto'],{'port':Config_1[a52_0x5a04e(0x13c)][a52_0x5a04e(0x167)],'json':Config_1[a52_0x5a04e(0x13c)]['isJson']}),exports[a52_0x5a04e(0x149)][a52_0x5a04e(0x13d)][a52_0x5a04e(0x140)][a52_0x5a04e(0x132)](async _0x38e1d5=>{const _0x194648=a52_0x5a04e,_0x247ba5={'JEgDT':_0x194648(0x157),'tFMTU':'[preApiCallFlow]\x20请求参数:','haofH':'[preApiCallFlow]\x20需要校验\x20token:','MBCOG':_0x194648(0x13a),'GkFZt':_0x194648(0x14c),'akEVh':_0x194648(0x144),'KRCSF':_0x194648(0x16c),'yGqtG':_0x194648(0x170),'KbxOU':_0x194648(0x146),'DtfOA':_0x194648(0x154),'RABvB':_0x194648(0x15e)},_0x2539f0=_0x38e1d5[_0x194648(0x171)][_0x194648(0x14a)];Logger_1[_0x194648(0x13b)][_0x194648(0x134)](_0x247ba5['JEgDT'],_0x2539f0),Logger_1['g_logger']['info'](_0x247ba5[_0x194648(0x133)],_0x38e1d5[_0x194648(0x16e)]);const _0x361019=_0x38e1d5[_0x194648(0x16e)][_0x194648(0x15a)];Logger_1[_0x194648(0x13b)]['info'](_0x247ba5[_0x194648(0x16a)],_0x361019);if(!_0x361019)return Logger_1[_0x194648(0x13b)][_0x194648(0x16b)](_0x247ba5['MBCOG']),_0x38e1d5[_0x194648(0x137)]('需要登录'),null;try{const _0x2828e5=jsonwebtoken_1[_0x194648(0x165)][_0x194648(0x135)](_0x361019,Config_1[_0x194648(0x13c)][_0x194648(0x160)]);Logger_1[_0x194648(0x13b)][_0x194648(0x134)](_0x247ba5[_0x194648(0x15d)],_0x2828e5),_0x38e1d5[_0x194648(0x16e)]['userId']=_0x2828e5[_0x194648(0x143)];}catch(_0x49d2d9){return Logger_1[_0x194648(0x13b)][_0x194648(0x137)](_0x247ba5[_0x194648(0x14d)],_0x49d2d9),_0x38e1d5['error'](_0x247ba5['KRCSF']),null;}if(_0x2539f0[_0x194648(0x150)](_0x247ba5['yGqtG']))return Logger_1[_0x194648(0x13b)][_0x194648(0x134)](_0x194648(0x151),_0x2539f0,_0x38e1d5['req']),await forwardApi(gameClient_1[_0x194648(0x139)],_0x38e1d5),_0x38e1d5;if(_0x2539f0[_0x194648(0x150)](_0x194648(0x162)))return Logger_1['g_logger'][_0x194648(0x134)](_0x247ba5[_0x194648(0x153)],_0x2539f0),await forwardApi(chatClient_1[_0x194648(0x139)],_0x38e1d5),_0x38e1d5;return Logger_1[_0x194648(0x13b)][_0x194648(0x16b)](_0x247ba5[_0x194648(0x163)],_0x2539f0),_0x38e1d5[_0x194648(0x137)](_0x247ba5[_0x194648(0x136)]),_0x38e1d5;});async function forwardApi(_0x438775,_0x309153){const _0x3d5059=a52_0x5a04e,_0x23272e={'JfYYn':_0x3d5059(0x169)},_0x5858fc=await _0x438775[_0x3d5059(0x142)](_0x309153[_0x3d5059(0x171)]['name'],_0x309153[_0x3d5059(0x16e)],{'timeout':0x2710});Logger_1[_0x3d5059(0x13b)][_0x3d5059(0x134)](_0x23272e['JfYYn'],_0x5858fc),_0x5858fc[_0x3d5059(0x16f)]?_0x309153[_0x3d5059(0x155)](_0x5858fc[_0x3d5059(0x14b)]):_0x309153[_0x3d5059(0x137)](_0x5858fc[_0x3d5059(0x13f)]);}function a52_0x5dfa(){const _0x388f6e=['akEVh','✅\x20WebSocket\x20connected','tsrpc','startsWith','[preApiCallFlow]\x20转发给\x20game\x20服务:','../../utils/Logger','KbxOU','[preApiCallFlow]\x20未知服务:','succ','__esModule','[preApiCallFlow]\x20收到请求:','9MLxmlI','connect','token','4rZkSxp','jsonwebtoken','GkFZt','Unknown\x20service','./clients/chatClient','JWT_SECRET','13348424BlSTWb','chat/','DtfOA','8539622KicntE','default','❌\x20WebSocket\x20connect\x20failed','proxy_server_port','9859212rVNeVT','[preApiCallFlow]\x20game\x20服务返回:','haofH','warn','Token\x20无效或已过期','../../common/Config','req','isSucc','game/','service','push','tFMTU','info','verify','RABvB','error','697566WIDCaC','client','[preApiCallFlow]\x20缺少\x20token，拒绝访问','g_logger','g_config','flows','1065676GfdWKY','err','preApiCallFlow','__importDefault','callApi','userId','[preApiCallFlow]\x20token\x20校验失败:','547094zdzOCm','[preApiCallFlow]\x20转发给\x20chat\x20服务:','5739505GRelos','WsServer','server','name','res','[preApiCallFlow]\x20token\x20校验成功，用户:'];a52_0x5dfa=function(){return _0x388f6e;};return a52_0x5dfa();}async function init(){const _0x512e4d=a52_0x5a04e,_0x3526c4={'MhPQD':'✅\x20代理服初始化'};Logger_1[_0x512e4d(0x13b)][_0x512e4d(0x134)](_0x3526c4['MhPQD']);let _0x4aaf80=await gameClient_1[_0x512e4d(0x139)][_0x512e4d(0x159)]();_0x4aaf80[_0x512e4d(0x16f)]?Logger_1['g_logger'][_0x512e4d(0x134)](_0x512e4d(0x14e)):Logger_1[_0x512e4d(0x13b)][_0x512e4d(0x16b)](_0x512e4d(0x166)),await chatClient_1[_0x512e4d(0x139)][_0x512e4d(0x159)]();}function a52_0x4be6(_0x343263,_0x55b136){const _0x5dfa32=a52_0x5dfa();return a52_0x4be6=function(_0x4be66d,_0x3c6157){_0x4be66d=_0x4be66d-0x132;let _0x52fe10=_0x5dfa32[_0x4be66d];return _0x52fe10;},a52_0x4be6(_0x343263,_0x55b136);};async function main(){const _0x1b13d5=a52_0x5a04e,_0x346e11={'hAKDG':function(_0x2b73bd){return _0x2b73bd();}};await _0x346e11['hAKDG'](init),await exports[_0x1b13d5(0x149)]['start']();}main();