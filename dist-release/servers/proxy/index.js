'use strict';const a52_0x3ab2dc=a52_0x3039;(function(_0x4a3963,_0x2ffeb6){const _0x4733bb=a52_0x3039,_0x1ff3c9=_0x4a3963();while(!![]){try{const _0x5a37bd=-parseInt(_0x4733bb(0x14a))/0x1+-parseInt(_0x4733bb(0x12b))/0x2+parseInt(_0x4733bb(0x142))/0x3+-parseInt(_0x4733bb(0x162))/0x4*(-parseInt(_0x4733bb(0x14d))/0x5)+parseInt(_0x4733bb(0x130))/0x6*(-parseInt(_0x4733bb(0x132))/0x7)+parseInt(_0x4733bb(0x15d))/0x8*(parseInt(_0x4733bb(0x141))/0x9)+parseInt(_0x4733bb(0x15a))/0xa;if(_0x5a37bd===_0x2ffeb6)break;else _0x1ff3c9['push'](_0x1ff3c9['shift']());}catch(_0x1f05bb){_0x1ff3c9['push'](_0x1ff3c9['shift']());}}}(a52_0x2925,0xa42db));var __importDefault=this&&this['__importDefault']||function(_0x3ede3e){const _0x63403b=a52_0x3039;return _0x3ede3e&&_0x3ede3e[_0x63403b(0x12c)]?_0x3ede3e:{'default':_0x3ede3e};};Object['defineProperty'](exports,a52_0x3ab2dc(0x12c),{'value':!![]}),exports[a52_0x3ab2dc(0x13f)]=void 0x0;const tsrpc_1=require(a52_0x3ab2dc(0x14b)),serviceProto_1=require('../../shared/protocols/serviceProto'),gameClient_1=require(a52_0x3ab2dc(0x12d)),chatClient_1=require('./clients/chatClient'),jsonwebtoken_1=__importDefault(require(a52_0x3ab2dc(0x14c))),Config_1=require(a52_0x3ab2dc(0x13c)),Logger_1=require('../../utils/Logger');exports[a52_0x3ab2dc(0x13f)]=new tsrpc_1[(a52_0x3ab2dc(0x14e))](serviceProto_1[a52_0x3ab2dc(0x13a)],{'port':Config_1['g_config']['proxy_server_port'],'json':Config_1[a52_0x3ab2dc(0x145)][a52_0x3ab2dc(0x147)]}),exports[a52_0x3ab2dc(0x13f)]['flows'][a52_0x3ab2dc(0x15b)][a52_0x3ab2dc(0x149)](async _0x11300e=>{const _0x367ead=a52_0x3ab2dc,_0x5533d1={'xyPoW':'[preApiCallFlow]\x20请求参数:','Vzgdt':'[preApiCallFlow]\x20需要校验\x20token:','dcfrR':'[preApiCallFlow]\x20缺少\x20token，拒绝访问','QzHOf':_0x367ead(0x15f),'NbeMF':'[preApiCallFlow]\x20token\x20校验成功，用户:','DewkE':'[preApiCallFlow]\x20token\x20校验失败:','iwhcP':_0x367ead(0x133),'YNagu':_0x367ead(0x135),'fejCM':'[preApiCallFlow]\x20转发给\x20chat\x20服务:','wAiZB':function(_0x505779,_0x33e2ec,_0x3abd61){return _0x505779(_0x33e2ec,_0x3abd61);},'XFkqz':_0x367ead(0x138)},_0x5ed765=_0x11300e['service']['name'];Logger_1['g_logger']['info'](_0x367ead(0x134),_0x5ed765),Logger_1[_0x367ead(0x161)][_0x367ead(0x12e)](_0x5533d1[_0x367ead(0x128)],_0x11300e[_0x367ead(0x152)]);const _0x40866e=_0x11300e[_0x367ead(0x152)][_0x367ead(0x140)];Logger_1[_0x367ead(0x161)][_0x367ead(0x12e)](_0x5533d1[_0x367ead(0x129)],_0x40866e);if(!_0x40866e)return Logger_1[_0x367ead(0x161)][_0x367ead(0x158)](_0x5533d1[_0x367ead(0x136)]),_0x11300e[_0x367ead(0x12a)](_0x5533d1['QzHOf']),null;try{const _0x481d2e=jsonwebtoken_1[_0x367ead(0x150)][_0x367ead(0x163)](_0x40866e,Config_1[_0x367ead(0x145)][_0x367ead(0x156)]);Logger_1[_0x367ead(0x161)][_0x367ead(0x12e)](_0x5533d1[_0x367ead(0x146)],_0x481d2e),_0x11300e[_0x367ead(0x152)][_0x367ead(0x151)]=_0x481d2e['userId'];}catch(_0x218cf8){return Logger_1['g_logger'][_0x367ead(0x12a)](_0x5533d1[_0x367ead(0x148)],_0x218cf8),_0x11300e[_0x367ead(0x12a)](_0x367ead(0x13b)),null;}if(_0x5ed765[_0x367ead(0x157)](_0x5533d1[_0x367ead(0x13d)]))return Logger_1[_0x367ead(0x161)][_0x367ead(0x12e)](_0x367ead(0x143),_0x5ed765,_0x11300e['req']),await forwardApi(gameClient_1[_0x367ead(0x127)],_0x11300e),_0x11300e;if(_0x5ed765[_0x367ead(0x157)](_0x5533d1['YNagu']))return Logger_1[_0x367ead(0x161)][_0x367ead(0x12e)](_0x5533d1[_0x367ead(0x12f)],_0x5ed765),await _0x5533d1[_0x367ead(0x13e)](forwardApi,chatClient_1[_0x367ead(0x127)],_0x11300e),_0x11300e;return Logger_1['g_logger'][_0x367ead(0x158)]('[preApiCallFlow]\x20未知服务:',_0x5ed765),_0x11300e[_0x367ead(0x12a)](_0x5533d1[_0x367ead(0x144)]),_0x11300e;});function a52_0x3039(_0x175a0e,_0x2e780c){const _0x2925fd=a52_0x2925();return a52_0x3039=function(_0x303956,_0x520b69){_0x303956=_0x303956-0x127;let _0x5c556=_0x2925fd[_0x303956];return _0x5c556;},a52_0x3039(_0x175a0e,_0x2e780c);}async function forwardApi(_0x199e02,_0x4ee8c2){const _0x5a5b88=a52_0x3ab2dc,_0xcd7f19={'fsBWd':_0x5a5b88(0x153)},_0x5cf6c3=await _0x199e02['callApi'](_0x4ee8c2[_0x5a5b88(0x15e)][_0x5a5b88(0x139)],_0x4ee8c2[_0x5a5b88(0x152)],{'timeout':0x2710});Logger_1['g_logger'][_0x5a5b88(0x12e)](_0xcd7f19['fsBWd'],_0x5cf6c3),_0x5cf6c3[_0x5a5b88(0x131)]?_0x4ee8c2['succ'](_0x5cf6c3[_0x5a5b88(0x14f)]):_0x4ee8c2[_0x5a5b88(0x12a)](_0x5cf6c3['err']);}async function init(){const _0xf06a86=a52_0x3ab2dc,_0xc1a964={'YnmMj':_0xf06a86(0x160)};Logger_1[_0xf06a86(0x161)][_0xf06a86(0x12e)](_0xc1a964[_0xf06a86(0x155)]);let _0x3f01b5=await gameClient_1[_0xf06a86(0x127)]['connect']();_0x3f01b5[_0xf06a86(0x131)]?Logger_1['g_logger'][_0xf06a86(0x12e)](_0xf06a86(0x15c)):Logger_1[_0xf06a86(0x161)][_0xf06a86(0x158)](_0xf06a86(0x137)),await chatClient_1['client'][_0xf06a86(0x159)]();}function a52_0x2925(){const _0x5af8a9=['JWT_SECRET','startsWith','warn','connect','7855560TMMnwF','preApiCallFlow','✅\x20WebSocket\x20connected','2276760iyvnZP','service','需要登录','✅\x20代理服初始化','g_logger','2438396CNrRQT','verify','client','xyPoW','Vzgdt','error','2134808PzxKYr','__esModule','./clients/gameClient','info','fejCM','12414veeSeY','isSucc','3185PRSFxI','game/','[preApiCallFlow]\x20收到请求:','chat/','dcfrR','❌\x20WebSocket\x20connect\x20failed','Unknown\x20service','name','serviceProto','Token\x20无效或已过期','../../common/Config','iwhcP','wAiZB','server','token','36wvoDaF','1218831ZUFvrj','[preApiCallFlow]\x20转发给\x20game\x20服务:','XFkqz','g_config','NbeMF','isJson','DewkE','push','868137JPulRb','tsrpc','jsonwebtoken','10QvlRWi','WsServer','res','default','userId','req','[preApiCallFlow]\x20game\x20服务返回:','start','YnmMj'];a52_0x2925=function(){return _0x5af8a9;};return a52_0x2925();};async function main(){const _0x123008=a52_0x3ab2dc,_0xb7e3be={'sJyWZ':function(_0x524981){return _0x524981();}};await _0xb7e3be['sJyWZ'](init),await exports[_0x123008(0x13f)][_0x123008(0x154)]();}main();